<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Floating Energy Core â€“ Containment Cylinder</title>

    <script src="../COMMON/webgl-utils.js"></script>
    <script src="../COMMON/initShaders.js"></script>
    <script src="../COMMON/MV.js"></script>

    <script src="core-geometry.js"></script>
    <script src="shard-geometry.js"></script>
    <script src="cylinder-geometry.js"></script>

    <script src="material-setup.js"></script> 
    <script src="pedestal-model.js"></script> 
    
    <script src="main.js"></script>

    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 vPosition;
        attribute vec3 aNormal;
        attribute vec2 vTexCoord;

        uniform mat4 uModel;
        uniform mat4 uView;
        uniform mat4 uProjection;
        uniform mat3 uNormalMatrix;

        varying vec3 fNormal;
        varying vec3 fPosition;
        varying vec2 fTexCoord;

        void main() {
            fPosition = (uView * uModel * vPosition).xyz;
            fNormal = normalize(uNormalMatrix * aNormal);
            fTexCoord = vTexCoord;
            gl_Position = uProjection * uView * uModel * vPosition;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;

        // Material uniforms
        uniform vec4 uAmbient;
        uniform vec4 uDiffuse;
        uniform vec4 uSpecular;
        uniform float uShininess;
        uniform float uAlpha; 

        // Lighting uniforms
        uniform vec3 uLightPos;
        uniform vec3 uCameraPos;

        // Texture uniforms
        uniform bool uUseTexture;
        uniform sampler2D uTexture;

        varying vec3 fNormal;
        varying vec3 fPosition;
        varying vec2 fTexCoord;

        void main() {
            vec3 N = normalize(fNormal);
            vec3 L = normalize(uLightPos - fPosition);
            vec3 V = normalize(uCameraPos - fPosition);
            vec3 H = normalize(L + V);

            vec4 ambientTerm = uAmbient;
            
            // Diffuse term
            float Kd = max(dot(L, N), 0.0);
            vec4 diffuseTerm = uDiffuse * Kd;

            // Specular term
            float Ks = pow(max(dot(N, H), 0.0), uShininess);
            vec4 specularTerm = uSpecular * Ks;

            // Combined color
            vec4 finalColor = ambientTerm + diffuseTerm + specularTerm;

            // Apply texture if enabled
            if (uUseTexture) {
                vec4 textureColor = texture2D(uTexture, fTexCoord);
                // Blend lighting with texture color
                finalColor = vec4(finalColor.rgb * textureColor.rgb, finalColor.a * textureColor.a);
            }

            // Apply transparency (uAlpha) to the final color's alpha channel
            gl_FragColor = vec4(finalColor.rgb, finalColor.a * uAlpha); 
        }
    </script>

</head>

<body>
    <canvas id="gl-canvas" width="800" height="600">
        Your browser does not support HTML5 canvas.
    </canvas>

    <div style="margin-top:10px;">
        <button onclick="orbitLeft()">Orbit Left</button>
        <button onclick="orbitRight()">Orbit Right</button>
        <button onclick="resetCamera()">Reset Camera</button>
        
        <button onclick="toggleProjection()">Toggle Projection (Perspective/Ortho)</button>
        <button onclick="toggleLightOrbit()">Toggle Light Orbit</button>
    </div>
    
    <div style="margin-top:10px;">
        Shard Orbit Radius Scale: 0.5 
        <input id="shardRadiusSlider" type="range"
               min="0.5" max="1.5" step="0.05" value="1.0"
               onchange="shardRadiusFactor = event.target.valueAsNumber;">
        1.5
    </div>

    <div style="margin-top:10px;">
        Shard Orbit Speed Scale: 0.1 
        <input id="shardSpeedSlider" type="range"
               min="0.1" max="2.0" step="0.1" value="1.0"
               onchange="shardSpeedFactor = event.target.valueAsNumber;">
        2.0
    </div>

    <div style="margin-top:10px;">
        Core Resolution (Triangles/Complexity):
        <button onclick="decreaseResolution()">Decrease Resolution (-)</button>
        <button onclick="increaseResolution()">Increase Resolution (+)</button>
    </div>
</body>
</html>