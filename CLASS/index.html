<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Floating Energy Core â€“ Containment Cylinder</title>

    <!-- COMMON utilities -->
    <script src="../COMMON/webgl-utils.js"></script>
    <script src="../COMMON/initShaders.js"></script>
    <script src="../COMMON/MV.js"></script>

    <!-- Project geometry -->
    <script src="core-geometry.js"></script>
    <script src="shard-geometry.js"></script>
    <script src="cylinder-geometry.js"></script>
    <script src="main.js"></script>

    <!-- =====================================================
         Vertex Shader
         ===================================================== -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 vPosition;
        attribute vec3 aNormal;
        attribute vec2 vTexCoord;

        uniform mat4 uModel;
        uniform mat4 uView;
        uniform mat4 uProjection;
        uniform mat3 uNormalMatrix;

        varying vec3 fNormal;
        varying vec3 fPosition;
        varying vec2 fTexCoord;

        void main() {
            fPosition = (uView * uModel * vPosition).xyz;
            fNormal = normalize(uNormalMatrix * aNormal);
            fTexCoord = vTexCoord;
            gl_Position = uProjection * uView * uModel * vPosition;
        }
    </script>

    <!-- =====================================================
         UPDATED: Fragment Shader (supports transparency)
         ===================================================== -->
    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;

        varying vec3 fNormal;
        varying vec3 fPosition;
        varying vec2 fTexCoord;

        uniform vec3 uLightPos;
        uniform vec3 uCameraPos;

        uniform vec4 uAmbient;
        uniform vec4 uDiffuse;
        uniform vec4 uSpecular;
        uniform float uShininess;

        uniform bool uUseTexture;
        uniform sampler2D uTexture;

        uniform float uAlpha;   // NEW

        void main() {
            vec3 N = normalize(fNormal);
            vec3 L = normalize(uLightPos - fPosition);
            vec3 V = normalize(uCameraPos - fPosition);
            vec3 H = normalize(L + V);

            float diff = max(dot(N, L), 0.0);
            float spec = pow(max(dot(N, H), 0.0), uShininess);

            vec4 texColor = vec4(1.0);
            if (uUseTexture) {
                texColor = texture2D(uTexture, fTexCoord);
            }

            vec4 color =
                uAmbient * texColor +
                uDiffuse * diff * texColor +
                uSpecular * spec;

            gl_FragColor = vec4(color.rgb, uAlpha);
        }
    </script>

</head>

<body>
    <canvas id="gl-canvas" width="800" height="600">
        Your browser does not support HTML5 canvas.
    </canvas>

    <div style="margin-top:10px;">
        <button onclick="orbitLeft()">Orbit Left</button>
        <button onclick="orbitRight()">Orbit Right</button>
        <button onclick="resetCamera()">Reset Camera</button>
    </div>
</body>
</html>
